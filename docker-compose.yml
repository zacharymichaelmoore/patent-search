services:
  app:
    build: .
    image: patent-app
    container_name: patent-app
    ports:
      - "8091:8090"
    environment:
      - QDRANT_URL=http://qdrant:6333
      - OLLAMA_URL=http://host.docker.internal:11434/api/generate
      - VECTOR_LOG_PATH=/app/vectorization_log.csv
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - ./frontend:/app/frontend
      - ./api:/app/api
      - ./vectorization:/app/vectorization
      - /mnt/storage_pool/uspto:/data/uspto:ro
      - /mnt/storage_pool/global/vectorization_log.csv:/app/vectorization_log.csv:ro
    depends_on:
      - qdrant

  qdrant:
    image: qdrant/qdrant:latest
    container_name: patent-search-qdrant
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - /home/zacharymoore/qdrant_storage:/qdrant/storage
